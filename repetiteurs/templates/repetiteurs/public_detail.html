<!-- filepath: c:\Users\Bano\Documents\University\Soutenance\KaramokoSoutenance\repetiteurs\templates\repetiteurs\public_detail.html -->
{% extends "_base.html" %}
{% load static %}

{% block content %}
<section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
        <!-- En-tête -->
        <div class="flex flex-col md:flex-row bg-white p-6 rounded-lg shadow-lg mb-8">
            <!-- Photo de profil -->
            <div class="flex-shrink-0 mb-4 md:mb-0">
                {% if repetiteur.avatar %}
                    <img class="w-32 h-32 rounded-full mx-auto md:mx-0" src="{{ repetiteur.avatar.url }}" alt="{{ repetiteur.user.first_name }}">
                {% else %}
                    <img class="w-32 h-32 rounded-full mx-auto md:mx-0" src="{% static 'images/default_avatar.webp' %}" alt="Photo de {{ repetiteur.user.first_name }}">
                {% endif %}
            </div>
            <!-- Informations principales -->
            <div class="ml-0 md:ml-6 text-center md:text-left">
                <h1 class="text-4xl font-bold text-gray-800">{{ repetiteur.user.first_name }} {{ repetiteur.user.last_name }}</h1>
                <p class="text-gray-600 mt-2"><i class="fas fa-map-marker-alt text-blue-500"></i> {{ repetiteur.user.adresse|default:"Adresse non spécifiée" }}</p>
                <div class="flex justify-center md:justify-start items-center space-x-2 mt-4">
                    <span class="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full">Disponible cette semaine</span>
                    <div class="flex items-center">
                        <span class="text-yellow-500">★★★★★</span>
                        <span class="text-gray-500 text-sm ml-2">({{ repetiteur.avis_count|default:"0" }} avis)</span>
                    </div>
                </div>
                {% comment %} <p class="text-gray-600 mt-4">A aidé plus de <span class="font-semibold">{{ repetiteur.etudiants_aides|default:"0" }}</span> élèves</p> {% endcomment %}
                <p class="text-gray-600">Prix par heure : <span class="font-semibold">{{ repetiteur.prix_par_seance|default:"Non spécifié" }} GNF</span></p>
            </div>
        </div>

        <!-- Navigation par onglets -->
        <div class="border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white z-40">
            <ul class="flex flex-wrap -mb-px text-sm font-medium text-center text-gray-500 dark:text-gray-400">
            <li class="me-2">
                <a href="#a-propos" data-tab="a-propos" class="tab-link inline-flex items-center justify-center p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300 group active">
                <svg class="w-4 h-4 me-2 text-gray-400 group-hover:text-gray-500 dark:text-gray-500 dark:group-hover:text-gray-300" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z"/>
                </svg>À propos
                </a>
            </li>
            <li class="me-2">
                <a href="#cv" data-tab="cv" class="tab-link inline-flex items-center justify-center p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300 group">
                <svg class="w-4 h-4 me-2 text-gray-400 group-hover:text-gray-500 dark:text-gray-500 dark:group-hover:text-gray-300" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M5 11.424V1a1 1 0 1 0-2 0v10.424a3.228 3.228 0 0 0 0 6.152V19a1 1 0 1 0 2 0v-1.424a3.228 3.228 0 0 0 0-6.152ZM19.25 14.5A3.243 3.243 0 0 0 17 11.424V1a1 1 0 0 0-2 0v10.424a3.227 3.227 0 0 0 0 6.152V19a1 1 0 1 0 2 0v-1.424a3.243 3.243 0 0 0 2.25-3.076Zm-6-9A3.243 3.243 0 0 0 11 2.424V1a1 1 0 0 0-2 0v1.424a3.228 3.228 0 0 0 0 6.152V19a1 1 0 1 0 2 0V8.576A3.243 3.243 0 0 0 13.25 5.5Z"/>
                </svg>CV
                </a>
            </li>
            <li class="me-2">
                <a href="#disponibilite" data-tab="disponibilite" class="tab-link inline-flex items-center justify-center p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300 group">
                <svg class="w-4 h-4 me-2 text-gray-400 group-hover:text-gray-500 dark:text-gray-500 dark:group-hover:text-gray-300" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M16 1h-3.278A1.992 1.992 0 0 0 11 0H7a1.993 1.993 0 0 0-1.722 1H2a2 2 0 0 0-2 2v15a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2Zm-3 14H5a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2Zm0-4H5a1 1 0 0 1 0-2h8a1 1 0 1 1 0 2Zm0-5H5a1 1 0 0 1 0-2h2V2h4v2h2a1 1 0 1 1 0 2Z"/>
                </svg>Disponibilité
                </a>
            </li>
            <li class="me-2">
                <a href="#avis" data-tab="avis" class="tab-link inline-flex items-center justify-center p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300 group">
                <svg class="w-4 h-4 me-2 text-gray-400 group-hover:text-gray-500 dark:text-gray-500 dark:group-hover:text-gray-300" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z"/>
                </svg>Avis ({{ repetiteur.avis_count|default:"0" }})
                </a>
            </li>
            </ul>
        </div>

        <!-- Contenu des onglets -->
        <div class="tab-content">
            <!-- Onglet "À propos" -->
            <div id="a-propos" class="tab-panel active mb-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Qui suis-je ?</h2>
                <p class="text-gray-600 leading-relaxed">{{ repetiteur.biographie|default:"Aucune biographie disponible."|linebreaksbr }}</p>
                {% if repetiteur.description_detaillee %}
                    <h4 class="text-lg font-semibold text-gray-700 mt-6 mb-2">En lire plus</h4>
                    <p class="text-gray-600 leading-relaxed">{{ repetiteur.description_detaillee|linebreaksbr }}</p>
                {% endif %}
            </div>

            <!-- Onglet "CV" -->
            <div id="cv" class="tab-panel mb-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">CV. En savoir plus sur {{ repetiteur.user.first_name }}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">Compétences :</h3>
                        <div class="flex flex-wrap gap-2">
                            {% for competence in repetiteur.competences.all %}
                                <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded ms-3">{{ competence }}</span>
                            {% empty %}
                                <span class="text-gray-500 text-sm">Non spécifié</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">Cours enseignés :</h3>
                        <div class="flex flex-wrap gap-2">
                            {% for cour in repetiteur.cours.all %}
                                <span class="inline-block mr-2 bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded">{{ cour }}</span>
                            {% empty %}
                                <span class="text-gray-500 text-sm">Non spécifié</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">Formations obtenues :</h3>
                        <div class="flex flex-wrap gap-2">
                            {% for formation in repetiteur.formations.all %}
                                <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded">{{ formation }}</span>
                            {% empty %}
                                <span class="text-gray-500 text-sm">Non spécifié</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet "Disponibilité" -->
            <div id="disponibilite" class="tab-panel mb-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Disponibilité</h2>
                <p class="text-gray-600 leading-relaxed">{{ repetiteur.disponibilite|default:"Non spécifiée."|linebreaksbr }}</p>
            </div>

            <!-- Onglet "Avis" -->
            <div id="avis" class="tab-panel mb-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Avis ({{ repetiteur.avis_count|default:"0" }})</h2>
                {% for avis in repetiteur.avis %}
                    <div class="border-b py-4">
                        <p class="text-gray-800 font-semibold">{{ avis.auteur }}</p>
                        <div class="flex items-center mt-1">
                            <span class="text-yellow-500">★★★★★</span>
                            <span class="text-gray-500 text-sm ml-2">{{ avis.note }}/5</span>
                            <span class="text-gray-500 text-sm ml-4">{{ avis.date }}</span>
                        </div>
                        <p class="text-gray-600 mt-2">{{ avis.commentaire }}</p>
                    </div>
                {% empty %}
                    <p class="text-gray-600">Aucun avis pour le moment.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<!-- Modal de souscription -->
    {% comment %} <div id="souscription-modal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative w-full max-w-md max-h-full">
            <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                <!-- En-tête du modal -->
                <div class="flex justify-between items-center p-5 border-b rounded-t dark:border-gray-600">
                    <h3 class="text-xl font-medium text-gray-900 dark:text-white">Ajouter une Souscription</h3>
                    <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="souscription-modal">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
                <!-- Contenu du modal -->
                <form method="POST" action="{% url 'souscription_create' repetiteur.id %}">
                    {% csrf_token %}
                    <div class="p-6 space-y-4">
                        <!-- Liste des cours -->
                        <div>
                            <label for="cours" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Cours</label>
                            <select id="cours" name="cours" multiple required class="block px-4 py-3 w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                {% for cours in repetiteur.cours.all %}
                                    <option value="{{ cours.id }}">{{ cours.titre }}</option>
                                {% empty %}
                                    <option disabled>Aucun cours disponible</option>
                                {% endfor %}
                            </select>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Maintenez la touche Ctrl (ou Cmd sur Mac) pour sélectionner plusieurs cours.</p>
                        </div>
                        <!-- Liste des plans -->
                        <div>
                            <label for="plan_tarifaire" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Plan Tarifaire</label>
                            <select id="plan_tarifaire" name="plan_tarifaire" required class="block px-4 py-3 w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                {% for plan in plans %}
                                    <option value="{{ plan.id }}">{{ plan.nom }} - {{ plan.duree }} mois</option>
                                {% empty %}
                                    <option disabled>Aucun plan tarifaire disponible</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Date de début -->
                        <div>
                            <label for="date_debut" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Date de début</label>
                            <input type="date" id="date_debut" name="date_debut" value="{{ date_today }}" readonly class="block px-4 py-3 w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <!-- Date de fin -->
                        <div>
                            <label for="date_fin" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Date de fin</label>
                            <input type="date" id="date_fin" name="date_fin" value="{{ date_fin }}" readonly class="block px-4 py-3 w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                    </div>
                    <!-- Boutons -->
                    <div class="flex items-center justify-end p-6 border-t border-gray-200 rounded-b dark:border-gray-600">
                        <button type="submit" class="px-4 py-2 bg-blue-700 text-white rounded-full shadow hover:bg-blue-800">Souscrire</button>
                    </div>
                </form>
            </div>
        </div>
    </div> {% endcomment %}
{% endblock %}

{% block extra_css %}
<style>
    .tab-panel {
        display: none;
    }
    .tab-panel.active {
        display: block;
    }
    .tab-link.active {
        border-bottom: 2px solid blue;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tabLinks = document.querySelectorAll('.tab-link');
        const tabPanels = document.querySelectorAll('.tab-panel');

        tabLinks.forEach(function(link) {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const tabId = this.getAttribute('data-tab');

                tabLinks.forEach(l => l.classList.remove('active'));
                tabPanels.forEach(p => p.classList.remove('active'));

                this.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Set the first tab as active on load
        tabLinks[0].classList.add('active');
        tabPanels[0].classList.add('active');
    });
</script>
{% endblock %}